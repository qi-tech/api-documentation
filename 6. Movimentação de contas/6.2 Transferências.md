# Transferências

A transferência entre contas é extremamente simples. Basta executar um
POST no endpoint /wire_transfer com os dados da conta de origem e da
conta de destino. O formato de assinatura do header e do body desta
requisição é descrito em detalhes [aqui](?file=224).

## Request

### Transferência

- endpoint: /wire_transfer
- method: POST
- body (antes de ser assinado):

```json
{
	"requester_document_number": "32402502000135",
	"source_account":{
		"account_branch": "0001",
		"account_digit": "3",
		"account_number": "24339",
		"owner_document_number": "32402502000135"
	},
	"target_account":{
		"account_branch": "0001",
		"account_digit": "6",
		"account_number": "78340",
		"financial_institution_code": "329",
		"owner_document_number": "32402502000135",
		"owner_name": "QI Tech"
	},
	"transaction_amount": 19000
}
```
<br>

#### Atributos de uma transferência

| Campo | Descrição | Exemplo
|---|---|---|
| **`requester_document_number`** | CPF ou CNPJ (apenas números) do solicitante da transferência (necessário apenas para transferências a partir de uma conta escrow) | "09456933000162" |
| **`source_account`** *(obrigatório)* | Conta de origem | **[Objeto Conta de Origem](?662#objeto-conta-origem)** |
| **`target_account`** *(obrigatório)* | Conta de destino | **[Objeto Conta de Destino](?662#objeto-conta-destino)** |
| **`transaction_amount`** *(obrigatório)* | Valor da transferência | 1891268.97 |

#### Objeto Conta de Origem <a name=objeto-conta-origem></a>

| Campo | Descrição | Exemplo
|---|---|---|
| **`account_branch`** *(obrigatório)* | Agência | "0001" |
| **`account_digit`** *(obrigatório)* | Dígito da conta | "3" |
| **`account_number`** *(obrigatório)* | Número da conta | "12345678" |
| **`owner_document_number`** *(obrigatório)* | CPF ou CNPJ (apenas números) do titular da conta | "32402502000135" |

Exemplo:

```json
{
    "account_branch": "0001",
    "account_digit": "3",
    "account_number": "24339",
    "owner_document_number": "32402502000135"
}
```
<br>

#### Objeto Conta de Destino <a name=objeto-conta-destino></a>

| Campo | Descrição | Exemplo
|---|---|---|
| **`account_branch`** *(obrigatório)* | Agência | "0001" |
| **`account_digit`** *(obrigatório)* | Dígito da conta | "3" |
| **`account_number`** *(obrigatório)* | Número da conta | "12345678" |
| **`financial_institution_code`** *(obrigatório)* | Código COMPE da instituição financeira | "329" |
| **`owner_document_number`** *(obrigatório)* | CPF ou CNPJ (apenas números) do titular da conta | "32402502000135" |
| **`owner_name`** *(obrigatório)* | Nome do titular da conta | "QI Tech" |

Exemplo:

```json
{
    "account_branch": "0001",
    "account_digit": "6",
    "account_number": "78340",
    "financial_institution_code": "329",
    "owner_document_number": "32402502000135",
    "owner_name": "QI Tech"
}
```
<br>

### Aprovação de Transferência

Para transferências partindo de contas escrow é necessária a aprovação
da mesma (por um agente que consta no contrato) antes de sua efetivação.

- endpoint: /wire_transfer_approval
- method: POST
- body (antes de ser assinado):

```json
{
	"approver_document_number": "32402502000135",
	"operation_key": "0e241203-8c6b-4e0a-ac42-e0d2a2fc2d37",
	"feedback": "approved"
}
```
<br>

#### Atributos de uma aprovação de transferência

| Campo | Descrição | Exemplo
|---|---|---|
| **`approver_document_number`** *(obrigatório)* | CPF ou CNPJ (apenas números) do aprovador da transferência | "09456933000162" |
| **`transaction_request_key`** *(obrigatório)* | Chave entregue quando a transferência foi criada (parâmetro key da resposta) | "0e241203-8c6b-4e0a-ac42-e0d2a2fc2d37" |
| **`feedback`** *(obrigatório)* | Aprovação ou rejeição da transferência: "approved" ou "rejected" | "approved" |

## Response
Todas as respostas vão conter uma chave de identificação da operação (key)

### Transferência

#### Transferência a partir de uma conta de livre movimentação

- status: 200
- body (após ser decodado): 
  
```json
{
    "data": {
        "source_account": {
            "account_branch": "0001",
            "account_digit": "3",
            "account_number": "24339",
            "owner_document_number": "32402502000135"
        },
        "target_account": {
            "account_branch": "0001",
            "account_digit": "6",
            "account_number": "78340",
            "financial_institution_code": "329",
            "owner_document_number": "32402502000135",
            "owner_name": "QI Tech"
        },
        "transaction_amount": 1891268.97
    },
    "event_datetime": "2019-11-28 19:22:04",
    "key": "0e241203-8c6b-4e0a-ac42-e0d2a2fc2d37",
    "status": "success",
    "webhook_type": "wire_transfer"
}
```
<br>

#### Transferência a partir de uma conta escrow

- status: 200
- body (após ser decodado): 
  
```json
{
    "data": {
        "requester_document_number": "32402502000135",
        "source_account": {
            "account_branch": "0001",
            "account_digit": "3",
            "account_number": "24339",
            "owner_document_number": "32402502000135"
        },
        "target_account": {
            "account_branch": "0001",
            "account_digit": "6",
            "account_number": "78340",
            "financial_institution_code": "329",
            "owner_document_number": "32402502000135",
            "owner_name": "QI Tech"
        },
        "transaction_amount": 1891268.97
    },
    "event_datetime": "2019-11-28 19:22:04",
    "key": "0e241203-8c6b-4e0a-ac42-e0d2a2fc2d37",
    "status": "waiting_approval",
    "webhook_type": "wire_transfer"
}
```
<br>

### Aprovação de Transferência

- status: 200
- body (após ser decodado): 
  
```json
{
    "event_datetime": "2019-11-28 18:24:26",
    "key": "d4b6a24c-dd6b-4cfa-b554-8ebc43efe144",
    "status": "approved",
    "webhook_type": "wire_transfer_approval"
}
```
<br>