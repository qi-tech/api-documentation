# Consultar saldo disponível assíncrono

A consulta de saldo assíncrono foi desenvolvida para trazer ainda mais desempenho e confiabilidade para o nosso cliente em suas consultas de saldo disponível para o saque de aniversário do FGTS. Com a arquitetura assincrona protegemos nossos clientes de instabilidades em serviços internos e externos, garantindo a completude da consulta.

A requisição será muito semelhante à versão síncrona, porém o resultado da consulta será entregue através de um webhook que será detalhado na sequencia.

<br> 

## Request / Etapa de validação

A etapa de validação será como a versão sincrona, porém o endpoint é diferente conforme exemplo abaixo:

- endpoint: /baas/fgts/available_balance_request
- method: POST
- body (antes de ser assinado)

```json
{
   "document_number":"41651732825"
}
```

<br>

### Atributos do payload da consulta de saldo disponível


| Campo                                 | Descrição                                | Exemplo |
|---------------------------------------|------------------------------------------|---------|
| **`document_number`** _(obrigatório)_ | CPF (apenas números) do titular da conta | "28110466079"   |

<br>
<br>

## Response


A resposta da requisição será conforme exemplo abaixo:

- status: 201
- body (após ser decodado): 

```json
{
  'document_number':'88473274318',
  'available_balance_key':'e038a83c-a9da-496c-b473-9894e9ec5018'
}
```

<br>


### Webhook de Resposta bem sucedida:

O Webhook de resposta bem sucedida trará uma resposta no modelo do exemplo abaixo:

```json
{
    "webhook_type": "available_balance_request",
    "event_datetime": "2022-05-20T20:24:42",
    "key": "238f6fad-9ceb-4d9d-8438-693205e508cc",
    "status": "success",
    "data": {
    document_number: "41651732825",
    reference_date: "2022-05-20T21:20:39",
    has_unavailable_balance: True,
    number_of_active_contracts: 5,
    periods: [
      { due_date: "2022-05-24T21:20:34",
       amount: 250.0}
    ]
    }
}
```

### Atributos do campo "data" do Webhook de resposta para a consulta de saldo disponível

| Campo                            | Descrição                                          | Exemplo                             |
|----------------------------------|----------------------------------------------------|-------------------------------------|
| **`document_number`**            | Número de documento (CPF)                          | "41651732825"                       |
| **`reference_date`**             | Data de referencia (formato "AAAA-MM-DD")          | "2022-05-20"                        |
| **`has_unavailable_balance`**    | Booleano se há saldo indisponível                  | "True or False"                     |
| **`number_of_active_contracts`** | Numero de contratos ativos                         | 2                                   |
| **`periods`**                    | Lista dos Períodos com seus respectivos valores disponíveis para reserva|                                     |
| **`periods.due_date`**           | data do repasse (formato "AAAA-MM-DD")             | "2022-05-20"                        |
| **`periods.amount`**             | valor do repasse                                   | 250.0                               |

<br>

### Webhook de Resposta com falha:

Se por alguma razão não for possivel consultar o saldo, o webhook de resposta com falha trará uma mensagem com o modelo do exemplo abaixo:

```json
{
  "webhook_type": "available_balance_request",
  "event_datetime": "2022-05-20T20:24:42",
  "key": "238f6fad-9ceb-4d9d-8438-693205e508cc",
  "status": "failed",
  "data": {
    error_code: "mensagem de erro"
    error_description: "descrição do erro"
  }
}
```


### Objeto Period
Mostra o valor desembosável pelo cliente em cada ano <a name=objeto-period></a>

| Campo          | Descrição                                    | Exemplo      |
|----------------|----------------------------------------------|--------------|
| **`due_date`** | Data Hora do Pedido (formato "AAAA-MM-DD")   | "2019-07-25" |
| **`amount`**   | Valor do saldo disponível em determinado ano | 565.20       |